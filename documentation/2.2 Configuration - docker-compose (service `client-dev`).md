
En mode **dÃ©veloppement**, on utilise `docker-compose` pour simplifier le lancement du conteneur basÃ© sur `Dockerfile.dev`.  
Cela permet de monter le code source local dans le conteneur et dâ€™avoir le **hot reload** actif (comme en local avec `npm start`).

---

## ğŸ”¹ Extrait `compose.yaml`

```yaml
services:
  client-dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    ports:
      - 3000:3000
    volumes:
      - .:/app
      - /app/node_modules
    environment:
      NODE_ENV: development
      HOST: 0.0.0.0
```

---

## ğŸ”¹ Explications

- **`build.context`** â†’ indique que le build se fait Ã  partir du rÃ©pertoire courant (`.`).
- **`dockerfile: Dockerfile.dev`** â†’ on utilise le `Dockerfile.dev` (mode dÃ©veloppement).
- **`ports: - 3000:3000`** â†’ expose le serveur CRA sur `http://localhost:3000`.
- **`volumes:`**
    - `.:/app` â†’ monte tout ton projet dans `/app` du conteneur â†’ chaque modification locale est immÃ©diatement reflÃ©tÃ©e.
    - `/app/node_modules` â†’ empÃªche que tes `node_modules` locaux Ã©crasent ceux installÃ©s dans le conteneur (âš¡ trÃ¨s important pour Ã©viter des bugs de dÃ©pendances).
- **`environment:`**
    - `NODE_ENV: development` â†’ dÃ©finit lâ€™environnement sur dÃ©veloppement.
    - `HOST: 0.0.0.0` â†’ permet dâ€™accÃ©der au serveur CRA depuis lâ€™extÃ©rieur du conteneur (par dÃ©faut CRA Ã©coute uniquement `localhost`).

##### ğŸ”¹ Quâ€™est-ce que `NODE_ENV` ?

- `NODE_ENV` est une **variable dâ€™environnement standard de Node.js**.
- Elle indique dans **quel mode** tourne ton application.
- Les valeurs les plus courantes sont :
    - `development` â†’ mode dev (hot reload, messages dÃ©taillÃ©s, erreurs verboses).
    - `production` â†’ mode prod (optimisations activÃ©es, logs limitÃ©s).
    - `test` â†’ utilisÃ© par Jest ou dâ€™autres frameworks de tests.
        
---

##### ğŸ”¹ Pourquoi câ€™est utile ici ?

Dans ton cas :
- **CRA (Create React App)** lit `NODE_ENV` au dÃ©marrage.

- Si `NODE_ENV=development`, CRA dÃ©marre le **serveur de dev** (`react-scripts start`) avec :
    - hot reload,
    - source maps (dÃ©bogage),
    - messages dâ€™erreur dÃ©taillÃ©s,
    - pas de minification.
    
- Si `NODE_ENV=production`, CRA sâ€™attend Ã  ce que tu serves les **fichiers buildÃ©s** (`npm run build` + serveur Nginx).
    - Donc ton `npm start` risque de ne pas fonctionner comme attendu â†’ il peut refuser de lancer le dev server ou tourner dans un Ã©tat "bizarre".
        

---

##### ğŸ”¹ Que se passe-t-il si tu lâ€™enlÃ¨ves ?

ğŸ‘‰ Plusieurs cas possibles :
1. **Pas de `NODE_ENV` dÃ©fini**
    - Node.js considÃ¨re gÃ©nÃ©ralement lâ€™environnement comme `development` par dÃ©faut.
    - Mais certains outils (dont CRA) **sâ€™appuient explicitement dessus** â†’ rÃ©sultat imprÃ©visible.
        
2. **`NODE_ENV=production` par dÃ©faut (ex: ton serveur VPS)**
    - Si tu lances `npm start` dans un conteneur sans `NODE_ENV=development`,  
        CRA **ne dÃ©marre pas le dev server** mais pense Ãªtre en prod â†’ il peut planter ou ignorer tes changements.
        
3. **Tu veux coder (dev)**
    - Sans `NODE_ENV=development`, le hot reload, les sourcemaps et les messages utiles disparaissent â†’ Ã§a devient inutilisable pour le dev.
        

---

###### ğŸ”¹ RÃ©sumÃ©

- **En dev** â†’ toujours mettre :
    ```yaml
    NODE_ENV: development
    ```
    pour que CRA active le bon mode (hot reload, logs dÃ©taillÃ©s).
    
- **En prod** â†’ soit tu le mets explicitement (`NODE_ENV=production`), soit tu le laisses par dÃ©faut (CRA va builder avec `npm run build` et câ€™est ton Nginx qui sert les fichiers statiques).
    

âš¡ En gros :
- `NODE_ENV=development` = "mode dÃ©veloppeur"
- `NODE_ENV=production` = "mode utilisateur final"
    
---

## ğŸ”¹ Commandes utiles

### Lancer le service dev :

```bash
docker compose up client-dev
```

ğŸ‘‰ Lâ€™application est accessible sur [http://localhost:3000](http://localhost:3000/).

### ArrÃªter le service :

```bash
docker compose down
```

### Avec le hot reload :

Toutes les modifications du code source sont reflÃ©tÃ©es **en temps rÃ©el** grÃ¢ce au volume `.:/app`.

---

âš¡ RÃ©sumÃ© :

- `client-dev` est dÃ©diÃ© au dÃ©veloppement â†’ **rapide, interactif, hot reload**.
- Tu nâ€™as pas besoin de rebuild lâ€™image Ã  chaque changement de code.
- Parfait pour coder avec CRA directement dans un conteneur Docker.
    
