

Ce pipeline couvre lâ€™ensemble du cycle de vie de ton application React avec Docker, du dÃ©veloppement local jusquâ€™au dÃ©ploiement automatisÃ© sur ton VPS Ionos.

---

## 9.1. ğŸ–¥ï¸ Dev â†’ `docker compose up client-dev`

- Utilise **Dockerfile.dev** et `docker-compose.yaml`.
    
- Lâ€™application tourne avec **hot-reload** grÃ¢ce aux volumes.
    
- Accessible sur [http://localhost:3000](http://localhost:3000/).
    
- Variables dâ€™environnement injectÃ©es directement via `docker-compose` (pas besoin de rebuild).
    

---

## 9.2. ğŸ—ï¸ Prod local â†’ `docker build && docker run`

- Utilise le **Dockerfile multi-stage (Node + Nginx)**.
    
- Les variables dâ€™environnement sont injectÃ©es au **build** via `--build-arg`.
    
- Commandes :
    

```bash
docker build -t client-cms \
  --build-arg REACT_APP_PRIMARY=#f542c2 \
  --build-arg REACT_APP_SECONDARY=#fcba03 \
  --build-arg REACT_APP_TITRE_SITE=titretest \
  --build-arg REACT_APP_USER=usertest .
docker run -p 8080:8080 client-cms
```

- Accessible sur [http://localhost:8080](http://localhost:8080/).
    

---

## 9.3. ğŸ“¡ POST API â†’ dÃ©clenche workflow

- Une requÃªte API (via `curl` ou `fetch`) appelle lâ€™endpoint GitHub REST `/dispatches`.
    
- Elle envoie un `client_payload` avec les valeurs (`primary`, `secondary`, `titreSite`, `user`).
    
- Exemple :
    

```bash
curl -X POST -H "Authorization: Bearer <PAT>" \
  https://api.github.com/repos/Collect-Verything/produits-cms-ui/dispatches \
  -d '{"event_type":"deploy-site","client_payload":{"primary":"#f542c2","secondary":"#fcba03","titreSite":"titretest","user":"usertest"}}'
```

- Retour attendu : **204 No Content** (succÃ¨s).
    

---

## 9.4. ğŸ³ Build & push image â†’ Docker Hub

- Le workflow GitHub Actions (`deploy.yml`) :
    
    1. **Build** lâ€™image avec les `--build-arg` dynamiques du `client_payload`.
        
    2. **Tag** lâ€™image : `${DOCKERHUB_USERNAME}/client-cms-<user>`.
        
    3. **Push** lâ€™image sur Docker Hub.
        
- RÃ©sultat : chaque utilisateur a son image unique disponible dans le registre Docker Hub.
    

---

## 9.5. ğŸš€ DÃ©ploiement auto sur VPS (port 80)

- Toujours via GitHub Actions â†’ connexion **SSH** au VPS (Ionos).
    
- Ã‰tapes exÃ©cutÃ©es automatiquement :
    
    - `docker stop` + `docker rm` (ancien conteneur).
        
    - `docker run -d -p 80:8080` (nouveau conteneur).
        
- Le firewall Ionos expose **80/443** â†’ lâ€™app est disponible sur :
    

```
http://<IP_SERVEUR>
```

---

## âœ… Conclusion gÃ©nÃ©rale

Ce pipeline assure :

- **Un environnement dev isolÃ©** avec hot reload (Docker Compose).
    
- **Un build reproductible** et optimisÃ© pour la prod (multi-stage + Nginx).
    
- **Une CI/CD automatisÃ©e** dÃ©clenchÃ©e par une simple requÃªte API.
    
- **Un dÃ©ploiement robuste** sur un VPS Ionos, exposÃ© sur le port 80.
    

âš¡ En un seul POST API, tu passes du **code source React** Ã  une **app live en prod sur ton VPS**.

---

Veux-tu que je fasse aussi une **checklist visuelle (Ã©tape par Ã©tape)** que tu pourras garder Ã  cÃ´tÃ© pour suivre le pipeline sans relire toutes les notes ?