

Ce pipeline couvre l’ensemble du cycle de vie de ton application React avec Docker, du développement local jusqu’au déploiement automatisé sur ton VPS Ionos.

---

## 9.1. 🖥️ Dev → `docker compose up client-dev`

- Utilise **Dockerfile.dev** et `docker-compose.yaml`.
    
- L’application tourne avec **hot-reload** grâce aux volumes.
    
- Accessible sur [http://localhost:3000](http://localhost:3000/).
    
- Variables d’environnement injectées directement via `docker-compose` (pas besoin de rebuild).
    

---

## 9.2. 🏗️ Prod local → `docker build && docker run`

- Utilise le **Dockerfile multi-stage (Node + Nginx)**.
    
- Les variables d’environnement sont injectées au **build** via `--build-arg`.
    
- Commandes :
    

```bash
docker build -t client-cms \
  --build-arg REACT_APP_PRIMARY=#f542c2 \
  --build-arg REACT_APP_SECONDARY=#fcba03 \
  --build-arg REACT_APP_TITRE_SITE=titretest \
  --build-arg REACT_APP_USER=usertest .
docker run -p 8080:8080 client-cms
```

- Accessible sur [http://localhost:8080](http://localhost:8080/).
    

---

## 9.3. 📡 POST API → déclenche workflow

- Une requête API (via `curl` ou `fetch`) appelle l’endpoint GitHub REST `/dispatches`.
    
- Elle envoie un `client_payload` avec les valeurs (`primary`, `secondary`, `titreSite`, `user`).
    
- Exemple :
    

```bash
curl -X POST -H "Authorization: Bearer <PAT>" \
  https://api.github.com/repos/Collect-Verything/produits-cms-ui/dispatches \
  -d '{"event_type":"deploy-site","client_payload":{"primary":"#f542c2","secondary":"#fcba03","titreSite":"titretest","user":"usertest"}}'
```

- Retour attendu : **204 No Content** (succès).
    

---

## 9.4. 🐳 Build & push image → Docker Hub

- Le workflow GitHub Actions (`deploy.yml`) :
    
    1. **Build** l’image avec les `--build-arg` dynamiques du `client_payload`.
        
    2. **Tag** l’image : `${DOCKERHUB_USERNAME}/client-cms-<user>`.
        
    3. **Push** l’image sur Docker Hub.
        
- Résultat : chaque utilisateur a son image unique disponible dans le registre Docker Hub.
    

---

## 9.5. 🚀 Déploiement auto sur VPS (port 80)

- Toujours via GitHub Actions → connexion **SSH** au VPS (Ionos).
    
- Étapes exécutées automatiquement :
    
    - `docker stop` + `docker rm` (ancien conteneur).
        
    - `docker run -d -p 80:8080` (nouveau conteneur).
        
- Le firewall Ionos expose **80/443** → l’app est disponible sur :
    

```
http://<IP_SERVEUR>
```

---

## ✅ Conclusion générale

Ce pipeline assure :

- **Un environnement dev isolé** avec hot reload (Docker Compose).
    
- **Un build reproductible** et optimisé pour la prod (multi-stage + Nginx).
    
- **Une CI/CD automatisée** déclenchée par une simple requête API.
    
- **Un déploiement robuste** sur un VPS Ionos, exposé sur le port 80.
    

⚡ En un seul POST API, tu passes du **code source React** à une **app live en prod sur ton VPS**.

---

Veux-tu que je fasse aussi une **checklist visuelle (étape par étape)** que tu pourras garder à côté pour suivre le pipeline sans relire toutes les notes ?