


Les **variables dâ€™environnement** sont essentielles dans une application **React** (CRA) pour injecter des valeurs dynamiques (API, couleurs, titre du site, utilisateur, etc.).  
Elles influencent directement le comportement de lâ€™application et doivent Ãªtre bien maÃ®trisÃ©es, surtout lorsquâ€™on utilise **Docker**.

---

## 4.1. Fichier `.env` (par dÃ©faut)

- CRA lit automatiquement un fichier nommÃ© `.env` placÃ© Ã  la racine du projet.
    
- Seules les variables prÃ©fixÃ©es par **`REACT_APP_`** sont prises en compte.
    

Exemple :

```env
# .env
REACT_APP_PRIMARY=#3498db
REACT_APP_SECONDARY=#2ecc71
REACT_APP_TITRE_SITE=Mon Super Site
REACT_APP_USER=admin@example.com
```

ğŸ‘‰ Ces variables sont accessibles dans ton code React via `process.env.REACT_APP_*`.

âš ï¸ En production, ce fichier doit gÃ©nÃ©ralement Ãªtre remplacÃ© ou injectÃ© par des valeurs spÃ©cifiques.

---

## 4.2. `--build-arg` lors du `docker build`

Lorsquâ€™on construit une image Docker, on peut passer les variables via `--build-arg`.

Exemple :

```bash
docker build \
  --build-arg REACT_APP_PRIMARY="#f542c2" \
  --build-arg REACT_APP_SECONDARY="#fcba03" \
  --build-arg REACT_APP_TITRE_SITE="titretest" \
  --build-arg REACT_APP_USER="usertest" \
  -t client-cms .
```

Dans le `Dockerfile` :

```dockerfile
ARG REACT_APP_PRIMARY
ENV REACT_APP_PRIMARY=${REACT_APP_PRIMARY}
```

ğŸ‘‰ Ici :

- `ARG` â†’ rÃ©cupÃ¨re la valeur passÃ©e par `--build-arg`.
- `ENV` â†’ la rend disponible dans le conteneur lors de lâ€™exÃ©cution de `npm run build`.
    

âš ï¸ Comme React est une application frontend compilÃ©e, les variables sont **injectÃ©es au moment du build** â†’ elles deviennent figÃ©es dans le code JavaScript livrÃ©.

---

## 4.3. PrioritÃ© entre `.env` et `--build-arg`

Lâ€™ordre de prioritÃ© est le suivant :

1. **`--build-arg`** â†’ valeur fournie explicitement Ã  la commande `docker build`.
2. **`.env`** â†’ si aucun `--build-arg` nâ€™est fourni, Docker utilisera les valeurs dÃ©finies dans `.env`.
3. **Valeur par dÃ©faut dans le `Dockerfile` (commentÃ©e ou non)** â†’ si rien nâ€™est fourni ailleurs.
    

---

### Exemple concret

- `.env` :
    ```env
    REACT_APP_PRIMARY=#000000
    ```
    
- Commande build :
    ```bash
    docker build --build-arg REACT_APP_PRIMARY="#ff0000" -t client-cms .
    ```
    

ğŸ‘‰ RÃ©sultat final dans lâ€™application :
- `REACT_APP_PRIMARY = "#ff0000"` (valeur `--build-arg` qui Ã©crase celle du `.env`).
    

---

## âœ… RÃ©sumÃ©

- **`.env`** â†’ pratique pour dev local et valeurs par dÃ©faut.
- **`--build-arg`** â†’ permet de personnaliser dynamiquement les builds (prod, staging, clients diffÃ©rents).
- **PrioritÃ©** â†’ `--build-arg` > `.env` > valeurs par dÃ©faut dans le `Dockerfile`.

ğŸ‘‰ GrÃ¢ce Ã  cette hiÃ©rarchie, tu peux :
- Travailler avec un `.env` simple en dev.
- Injecter des variables dynamiques cÃ´tÃ© CI/CD (GitHub Actions, etc.) via `--build-arg`.
    
