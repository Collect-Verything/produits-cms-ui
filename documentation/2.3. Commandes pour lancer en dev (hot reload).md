
En mode développement, on utilise le **service `client-dev`** défini dans `compose.yaml`.  
Ce service s’appuie sur le `Dockerfile.dev`, qui lance le serveur intégré de **Create React App (CRA)** avec **hot reload** activé.

---

## 🔹 Étape 1 : Construire l’image (optionnel)

Lors du premier lancement ou après modification du `Dockerfile.dev`, tu peux forcer le build :

```bash
docker compose build client-dev
```

---

## 🔹 Étape 2 : Lancer le service dev

```bash
docker compose up client-dev
```

👉 Cette commande :
- utilise le service **`client-dev`** décrit dans `compose.yaml`,
- lance un conteneur basé sur le **Dockerfile.dev**,
- démarre CRA en mode développement (`npm start`),
- expose l’application sur (http://localhost:3000/)*.
    

---

## 🔹 Étape 3 : Modifier ton code avec hot reload

Grâce au volume déclaré dans `compose.yaml` :

```yaml
volumes:
  - .:/app
  - /app/node_modules
```

- Chaque changement de fichier dans ton projet est **immédiatement reflété dans le conteneur**.
- CRA détecte le changement et **rafraîchit la page automatiquement** (hot reload).
- Pas besoin de rebuild l’image à chaque fois → 🚀 développement rapide.
    

---

## 🔹 Étape 4 : Arrêter le service

```bash
docker compose down
```

👉 Cela stoppe et supprime le conteneur `client-dev`.

---

## 🔹 Résumé du lien entre les fichiers

- `docker-compose.yaml` → définit le service **client-dev**.
- `Dockerfile.dev` → décrit l’image utilisée par ce service.
- Commande `docker compose up client-dev` → lance l’app React en **mode développement avec hot reload**.
    
---

⚡ En clair :
- **Dockerfile.dev** = recette de l’image dev (serveur CRA, hot reload).
- **compose.yaml (client-dev)** = configuration du service (ports, volumes, env).
- **docker compose up client-dev** = la commande qui relie les deux pour démarrer ton environnement de développement.
    


## 🌱 Variables d’environnement en mode Dev

Dans une application **Create React App (CRA)**, les variables d’environnement doivent :

- **commencer par `REACT_APP_`** (sinon elles sont ignorées par CRA),
- être accessibles depuis `process.env.REACT_APP_...`.
    

---

## 🔹 Où les définir en mode dev ?

### 1. Dans un fichier `.env`

Exemple :

```env
REACT_APP_PRIMARY=#f542c2
REACT_APP_SECONDARY=#fcba03
REACT_APP_TITRE_SITE=Mon Super Site
REACT_APP_USER=devUser
```

👉 Quand tu lances `npm start` (même dans Docker), CRA lit automatiquement ce fichier `.env`.

---

### 2. Dans `docker-compose.yaml` (service `client-dev`)

Tu peux aussi définir des variables directement dans `compose.yaml` :

```yaml
client-dev:
  build:
    context: .
    dockerfile: Dockerfile.dev
  ports:
    - 3000:3000
  volumes:
    - .:/app
    - /app/node_modules
  environment:
    NODE_ENV: development
    HOST: 0.0.0.0
    REACT_APP_PRIMARY: "#f542c2"
    REACT_APP_SECONDARY: "#fcba03"
    REACT_APP_TITRE_SITE: "Mon Super Site"
    REACT_APP_USER: "devUser"
```

👉 Ces variables seront injectées dans le conteneur et CRA les utilisera comme si elles venaient du `.env`.
👉 Ici, CRA va lire ces variables **comme si elles venaient d’un `.env`**, puisque elles sont injectées dans l’environnement du conteneur.  
Donc , tu peux parfaitement te passer de `.env` si tu les mets dans `docker-compose.yaml`.

- Si un `.env` est présent à la racine du projet (à côté du `package.json`), CRA le lit automatiquement quand tu fais `npm start`.
- Avec Docker, tu peux monter ton `.env` dans le conteneur, ou bien laisser Docker l’utiliser directement :
    
```docker-compose.yaml
env_file:   - .env
```
---

## 🔹 Quelle différence entre Dev et Prod ?

- **En Dev** (`npm start`) :
    - CRA lit les variables au démarrage (depuis `.env` ou `compose.yaml`).
    - Tu peux les modifier et relancer ton conteneur pour tester différents scénarios.

- **En Prod** (`npm run build`) :
    - Les variables doivent être fournies **au moment du build** via `--build-arg` (elles sont figées dans le bundle).
    - Changer le `.env` après le build **n’aura aucun effet** → il faut rebuilder l’image.
        

---

## 🔹 Résumé

- En **dev**, les variables `REACT_APP_*` peuvent être définies dans `.env` ou dans `docker-compose.yaml`.
- Elles sont lues dynamiquement par CRA au lancement du serveur de dev.
- En **prod**, elles sont injectées **au build** et figées dans l’image.
    

## 🌍 Gestion des `.env` dans CRA

CRA supporte **plusieurs fichiers `.env`**, qui sont automatiquement lus en fonction de l’environnement (`NODE_ENV`).

---

## 🔹 Fichiers possibles

1. **`.env`**
    - Fichier de base → toujours lu, quel que soit l’environnement.
        
2. **`.env.development`**
    - Spécifique au mode **développement** (`npm start`).
    - Exemple :
        
        ```env
        REACT_APP_API_URL=http://localhost:5000
        ```
        
1. **`.env.production`**
    - Spécifique au mode **production** (`npm run build`).
    - Exemple :
        ```env
        REACT_APP_API_URL=https://api.monsite.com
        ```
        
2. **`.env.test`**
    - Utilisé lors des tests (`npm test`).
        

---

## 🔹 Ordre de priorité

CRA charge les fichiers dans cet ordre (du plus fort au plus faible) :
1. `.env.development` / `.env.production` / `.env.test` (selon `NODE_ENV`)
2. `.env.local` (jamais commité, pour surcharger en local)
3. `.env` (base, partagé entre tous les environnements)
    

👉 Exemple :
- Si tu as `.env` avec `REACT_APP_API_URL=http://default.local`
- et `.env.development` avec `REACT_APP_API_URL=http://localhost:5000`  
    → alors en dev (`npm start`), c’est la valeur de `.env.development` qui gagne.
    

---

## 🔹 Comment CRA choisit le bon fichier ?

- Quand tu fais :
    ```bash
    npm start
    ```
    
    → CRA lance **`NODE_ENV=development`**, donc il charge `.env.development` (et `.env`).
    
- Quand tu fais :
    ```bash
    npm run build
    ```
    
    → CRA lance **`NODE_ENV=production`**, donc il charge `.env.production` (et `.env`).

👉 Pas besoin de préciser toi-même `NODE_ENV` → CRA le définit automatiquement selon la commande.

---

## 🔹 Exemple d’utilisation

- **.env**
    
    ```env
    REACT_APP_TITRE_SITE=MonApp
    ```
    
- **.env.development**
    
    ```env
    REACT_APP_API_URL=http://localhost:5000
    ```
    
- **.env.production**
    
    ```env
    REACT_APP_API_URL=https://api.monsite.com
    ```
    

👉 Résultat :
- En dev → `process.env.REACT_APP_API_URL` = `http://localhost:5000`
- En prod → `process.env.REACT_APP_API_URL` = `https://api.monsite.com`
    

---

⚡ Résumé :

- CRA **sélectionne automatiquement** le bon `.env` en fonction de la commande (`start`, `build`, `test`).
- Tu peux utiliser `.env` pour les valeurs communes et `.env.{mode}` pour les valeurs spécifiques.
- Tous les noms doivent commencer par `REACT_APP_`.
    