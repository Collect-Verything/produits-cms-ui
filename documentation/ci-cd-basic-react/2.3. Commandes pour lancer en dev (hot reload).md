
En mode dÃ©veloppement, on utilise le **service `client-dev`** dÃ©fini dans `compose.yaml`.  
Ce service sâ€™appuie sur le `Dockerfile.dev`, qui lance le serveur intÃ©grÃ© de **Create React App (CRA)** avec **hot reload** activÃ©.

---

## ğŸ”¹ Ã‰tape 1 : Construire lâ€™image (optionnel)

Lors du premier lancement ou aprÃ¨s modification du `Dockerfile.dev`, tu peux forcer le build :

```bash
docker compose build client-dev
```

---

## ğŸ”¹ Ã‰tape 2 : Lancer le service dev

```bash
docker compose up client-dev
```

ğŸ‘‰ Cette commande :
- utilise le service **`client-dev`** dÃ©crit dans `compose.yaml`,
- lance un conteneur basÃ© sur le **Dockerfile.dev**,
- dÃ©marre CRA en mode dÃ©veloppement (`npm start`),
- expose lâ€™application sur (http://localhost:3000/)*.
    

---

## ğŸ”¹ Ã‰tape 3 : Modifier ton code avec hot reload

GrÃ¢ce au volume dÃ©clarÃ© dans `compose.yaml` :

```yaml
volumes:
  - .:/app
  - /app/node_modules
```

- Chaque changement de fichier dans ton projet est **immÃ©diatement reflÃ©tÃ© dans le conteneur**.
- CRA dÃ©tecte le changement et **rafraÃ®chit la page automatiquement** (hot reload).
- Pas besoin de rebuild lâ€™image Ã  chaque fois â†’ ğŸš€ dÃ©veloppement rapide.
    

---

## ğŸ”¹ Ã‰tape 4 : ArrÃªter le service

```bash
docker compose down
```

ğŸ‘‰ Cela stoppe et supprime le conteneur `client-dev`.

---

## ğŸ”¹ RÃ©sumÃ© du lien entre les fichiers

- `docker-compose.yaml` â†’ dÃ©finit le service **client-dev**.
- `Dockerfile.dev` â†’ dÃ©crit lâ€™image utilisÃ©e par ce service.
- Commande `docker compose up client-dev` â†’ lance lâ€™app React en **mode dÃ©veloppement avec hot reload**.
    
---

âš¡ En clair :
- **Dockerfile.dev** = recette de lâ€™image dev (serveur CRA, hot reload).
- **compose.yaml (client-dev)** = configuration du service (ports, volumes, env).
- **docker compose up client-dev** = la commande qui relie les deux pour dÃ©marrer ton environnement de dÃ©veloppement.
    


## ğŸŒ± Variables dâ€™environnement en mode Dev

Dans une application **Create React App (CRA)**, les variables dâ€™environnement doivent :

- **commencer par `REACT_APP_`** (sinon elles sont ignorÃ©es par CRA),
- Ãªtre accessibles depuis `process.env.REACT_APP_...`.
    

---

## ğŸ”¹ OÃ¹ les dÃ©finir en mode dev ?

### 1. Dans un fichier `.env`

Exemple :

```env
REACT_APP_PRIMARY=#f542c2
REACT_APP_SECONDARY=#fcba03
REACT_APP_TITRE_SITE=Mon Super Site
REACT_APP_USER=devUser
```

ğŸ‘‰ Quand tu lances `npm start` (mÃªme dans Docker), CRA lit automatiquement ce fichier `.env`.

---

### 2. Dans `docker-compose.yaml` (service `client-dev`)

Tu peux aussi dÃ©finir des variables directement dans `compose.yaml` :

```yaml
client-dev:
  build:
    context: .
    dockerfile: Dockerfile.dev
  ports:
    - 3000:3000
  volumes:
    - .:/app
    - /app/node_modules
  environment:
    NODE_ENV: development
    HOST: 0.0.0.0
    REACT_APP_PRIMARY: "#f542c2"
    REACT_APP_SECONDARY: "#fcba03"
    REACT_APP_TITRE_SITE: "Mon Super Site"
    REACT_APP_USER: "devUser"
```

ğŸ‘‰ Ces variables seront injectÃ©es dans le conteneur et CRA les utilisera comme si elles venaient du `.env`.
ğŸ‘‰ Ici, CRA va lire ces variables **comme si elles venaient dâ€™un `.env`**, puisque elles sont injectÃ©es dans lâ€™environnement du conteneur.  
Donc , tu peux parfaitement te passer de `.env` si tu les mets dans `docker-compose.yaml`.

- Si un `.env` est prÃ©sent Ã  la racine du projet (Ã  cÃ´tÃ© du `package.json`), CRA le lit automatiquement quand tu fais `npm start`.
- Avec Docker, tu peux monter ton `.env` dans le conteneur, ou bien laisser Docker lâ€™utiliser directement :
    
```docker-compose.yaml
env_file:   - .env
```
---

## ğŸ”¹ Quelle diffÃ©rence entre Dev et Prod ?

- **En Dev** (`npm start`) :
    - CRA lit les variables au dÃ©marrage (depuis `.env` ou `compose.yaml`).
    - Tu peux les modifier et relancer ton conteneur pour tester diffÃ©rents scÃ©narios.

- **En Prod** (`npm run build`) :
    - Les variables doivent Ãªtre fournies **au moment du build** via `--build-arg` (elles sont figÃ©es dans le bundle).
    - Changer le `.env` aprÃ¨s le build **nâ€™aura aucun effet** â†’ il faut rebuilder lâ€™image.
        

---

## ğŸ”¹ RÃ©sumÃ©

- En **dev**, les variables `REACT_APP_*` peuvent Ãªtre dÃ©finies dans `.env` ou dans `docker-compose.yaml`.
- Elles sont lues dynamiquement par CRA au lancement du serveur de dev.
- En **prod**, elles sont injectÃ©es **au build** et figÃ©es dans lâ€™image.
    

## ğŸŒ Gestion des `.env` dans CRA

CRA supporte **plusieurs fichiers `.env`**, qui sont automatiquement lus en fonction de lâ€™environnement (`NODE_ENV`).

---

## ğŸ”¹ Fichiers possibles

1. **`.env`**
    - Fichier de base â†’ toujours lu, quel que soit lâ€™environnement.
        
2. **`.env.development`**
    - SpÃ©cifique au mode **dÃ©veloppement** (`npm start`).
    - Exemple :
        
        ```env
        REACT_APP_API_URL=http://localhost:5000
        ```
        
1. **`.env.production`**
    - SpÃ©cifique au mode **production** (`npm run build`).
    - Exemple :
        ```env
        REACT_APP_API_URL=https://api.monsite.com
        ```
        
2. **`.env.test`**
    - UtilisÃ© lors des tests (`npm test`).
        

---

## ğŸ”¹ Ordre de prioritÃ©

CRA charge les fichiers dans cet ordre (du plus fort au plus faible) :
1. `.env.development` / `.env.production` / `.env.test` (selon `NODE_ENV`)
2. `.env.local` (jamais commitÃ©, pour surcharger en local)
3. `.env` (base, partagÃ© entre tous les environnements)
    

ğŸ‘‰ Exemple :
- Si tu as `.env` avec `REACT_APP_API_URL=http://default.local`
- et `.env.development` avec `REACT_APP_API_URL=http://localhost:5000`  
    â†’ alors en dev (`npm start`), câ€™est la valeur de `.env.development` qui gagne.
    

---

## ğŸ”¹ Comment CRA choisit le bon fichier ?

- Quand tu fais :
    ```bash
    npm start
    ```
    
    â†’ CRA lance **`NODE_ENV=development`**, donc il charge `.env.development` (et `.env`).
    
- Quand tu fais :
    ```bash
    npm run build
    ```
    
    â†’ CRA lance **`NODE_ENV=production`**, donc il charge `.env.production` (et `.env`).

ğŸ‘‰ Pas besoin de prÃ©ciser toi-mÃªme `NODE_ENV` â†’ CRA le dÃ©finit automatiquement selon la commande.

---

## ğŸ”¹ Exemple dâ€™utilisation

- **.env**
    
    ```env
    REACT_APP_TITRE_SITE=MonApp
    ```
    
- **.env.development**
    
    ```env
    REACT_APP_API_URL=http://localhost:5000
    ```
    
- **.env.production**
    
    ```env
    REACT_APP_API_URL=https://api.monsite.com
    ```
    

ğŸ‘‰ RÃ©sultat :
- En dev â†’ `process.env.REACT_APP_API_URL` = `http://localhost:5000`
- En prod â†’ `process.env.REACT_APP_API_URL` = `https://api.monsite.com`
    

---

âš¡ RÃ©sumÃ© :

- CRA **sÃ©lectionne automatiquement** le bon `.env` en fonction de la commande (`start`, `build`, `test`).
- Tu peux utiliser `.env` pour les valeurs communes et `.env.{mode}` pour les valeurs spÃ©cifiques.
- Tous les noms doivent commencer par `REACT_APP_`.
    