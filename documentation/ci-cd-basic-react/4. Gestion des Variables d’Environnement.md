


Les **variables d’environnement** sont essentielles dans une application **React** (CRA) pour injecter des valeurs dynamiques (API, couleurs, titre du site, utilisateur, etc.).  
Elles influencent directement le comportement de l’application et doivent être bien maîtrisées, surtout lorsqu’on utilise **Docker**.

---

## 4.1. Fichier `.env` (par défaut)

- CRA lit automatiquement un fichier nommé `.env` placé à la racine du projet.
    
- Seules les variables préfixées par **`REACT_APP_`** sont prises en compte.
    

Exemple :

```env
# .env
REACT_APP_PRIMARY=#3498db
REACT_APP_SECONDARY=#2ecc71
REACT_APP_TITRE_SITE=Mon Super Site
REACT_APP_USER=admin@example.com
```

👉 Ces variables sont accessibles dans ton code React via `process.env.REACT_APP_*`.

⚠️ En production, ce fichier doit généralement être remplacé ou injecté par des valeurs spécifiques.

---

## 4.2. `--build-arg` lors du `docker build`

Lorsqu’on construit une image Docker, on peut passer les variables via `--build-arg`.

Exemple :

```bash
docker build \
  --build-arg REACT_APP_PRIMARY="#f542c2" \
  --build-arg REACT_APP_SECONDARY="#fcba03" \
  --build-arg REACT_APP_TITRE_SITE="titretest" \
  --build-arg REACT_APP_USER="usertest" \
  -t client-cms .
```

Dans le `Dockerfile` :

```dockerfile
ARG REACT_APP_PRIMARY
ENV REACT_APP_PRIMARY=${REACT_APP_PRIMARY}
```

👉 Ici :

- `ARG` → récupère la valeur passée par `--build-arg`.
- `ENV` → la rend disponible dans le conteneur lors de l’exécution de `npm run build`.
    

⚠️ Comme React est une application frontend compilée, les variables sont **injectées au moment du build** → elles deviennent figées dans le code JavaScript livré.

---

## 4.3. Priorité entre `.env` et `--build-arg`

L’ordre de priorité est le suivant :

1. **`--build-arg`** → valeur fournie explicitement à la commande `docker build`.
2. **`.env`** → si aucun `--build-arg` n’est fourni, Docker utilisera les valeurs définies dans `.env`.
3. **Valeur par défaut dans le `Dockerfile` (commentée ou non)** → si rien n’est fourni ailleurs.
    

---

### Exemple concret

- `.env` :
    ```env
    REACT_APP_PRIMARY=#000000
    ```
    
- Commande build :
    ```bash
    docker build --build-arg REACT_APP_PRIMARY="#ff0000" -t client-cms .
    ```
    

👉 Résultat final dans l’application :
- `REACT_APP_PRIMARY = "#ff0000"` (valeur `--build-arg` qui écrase celle du `.env`).
    

---

## ✅ Résumé

- **`.env`** → pratique pour dev local et valeurs par défaut.
- **`--build-arg`** → permet de personnaliser dynamiquement les builds (prod, staging, clients différents).
- **Priorité** → `--build-arg` > `.env` > valeurs par défaut dans le `Dockerfile`.

👉 Grâce à cette hiérarchie, tu peux :
- Travailler avec un `.env` simple en dev.
- Injecter des variables dynamiques côté CI/CD (GitHub Actions, etc.) via `--build-arg`.
    
