

Le dÃ©ploiement sur un VPS implique non seulement lâ€™installation et le lancement de Docker, mais aussi la gestion des **firewalls** et du **mapping de ports**. Avec Ionos, il faut bien comprendre la distinction entre firewall **externe (console Ionos)** et firewall **interne (sur ton VPS via UFW)**.

---

## 8.1. Firewall externe Ionos (ports 80/443)

- Sur lâ€™interface **Ionos**, chaque VPS dispose dâ€™un firewall externe (appelÃ© â€œpare-feu rÃ©seauâ€).
- Par dÃ©faut, seuls certains ports sont ouverts (`22` pour SSH, parfois `80`/`443`).
- Si tu lances ton conteneur avec un port **non ouvert** (ex: `8080`), tu ne verras rien depuis ton navigateur â†’ le trafic est bloquÃ© en amont.

ğŸ‘‰ Pour une application web, il faut :
- **Ouvrir le port 80 (HTTP)**
- **Ouvrir le port 443 (HTTPS)** si tu ajoutes SSL (via certbot/nginx).
    

âš ï¸ Pas besoin dâ€™ouvrir `8080` si tu fais un mapping vers `80` (voir 8.3).
Ionos possede deja une config de par feu de base contrairement a un aws ec2 par exemple pour le qul il faut parametrer et creer un ou des groupes de securitÃ©s

---

## 8.2. Firewall interne (UFW)

- Ton VPS (Ubuntu, Debian, etc.) peut avoir un firewall interne comme **UFW**.
- Si UFW est activÃ©, il faut aussi y autoriser les ports.
    

Exemple :

```bash
# VÃ©rifier lâ€™Ã©tat
sudo ufw status

# Autoriser HTTP et HTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# (optionnel) autoriser un port spÃ©cifique si nÃ©cessaire
sudo ufw allow 8080/tcp
```

ğŸ‘‰ MÃªme si tu ouvres le port cÃ´tÃ© Ionos, si UFW le bloque sur ton VPS â†’ impossible dâ€™y accÃ©der. ( a voire ... )

---

## 8.3. Mapping des ports (`-p 80:8080`)

Ton application React est servie par **Nginx dans le conteneur** â†’ et ce Nginx Ã©coute sur le **port 8080 interne** (dÃ©fini dans `nginx.conf`).

Pour la rendre accessible depuis lâ€™extÃ©rieur :

```bash
docker run -d -p 80:8080 client-cms
```

- `80:8080` â†’ redirige le **port 80 de lâ€™hÃ´te (VPS)** vers le **port 8080 interne du conteneur**.
    
- RÃ©sultat :
    
    - Depuis ton navigateur â†’ tu accÃ¨des via `http://<IP_SERVEUR>` (port 80).
        
    - En interne â†’ la requÃªte est renvoyÃ©e vers Nginx qui Ã©coute sur `8080`.
        

ğŸ‘‰ Cela permet dâ€™utiliser les **ports standards du web (80/443)** tout en gardant une config Nginx classique sur `8080`.

---

## 8.4. Commandes SSH pour lancer/arrÃªter un conteneur

Depuis ton VPS (via SSH `ssh user@ip`), voici les commandes utiles :

### ğŸ”¹ Lancer un conteneur

```bash
docker run -d --name client-cms-usertest -p 80:8080 client-cms-usertest
```

- `-d` â†’ mode dÃ©tachÃ© (le conteneur tourne en arriÃ¨re-plan).
    
- `--name` â†’ donne un nom explicite (pratique pour lâ€™arrÃªter/redÃ©marrer).
    
- `-p 80:8080` â†’ mapping port hÃ´te/containeur.
    
- `client-cms-usertest` â†’ image Docker (locale ou rÃ©cupÃ©rÃ©e de Docker Hub).
    

---

### ğŸ”¹ VÃ©rifier les conteneurs actifs

```bash
docker ps
```

Affiche les conteneurs en cours dâ€™exÃ©cution, leurs noms, et les ports exposÃ©s.

---

### ğŸ”¹ ArrÃªter un conteneur

```bash
docker stop client-cms-usertest
```

ArrÃªte proprement le conteneur.

---

### ğŸ”¹ Supprimer un conteneur

```bash
docker rm client-cms-usertest
```

âš ï¸ Un conteneur doit Ãªtre arrÃªtÃ© avant dâ€™Ãªtre supprimÃ©.

---

### ğŸ”¹ Re-dÃ©ployer (pattern courant)

Souvent utilisÃ© dans les scripts CI/CD :

```bash
docker stop client-cms-usertest || true
docker rm client-cms-usertest || true
docker run -d --name client-cms-usertest -p 80:8080 client-cms-usertest
```

- `|| true` â†’ Ã©vite que le script Ã©choue si le conteneur nâ€™existe pas encore.
    
- Cela permet de **toujours repartir sur un conteneur neuf** avec la derniÃ¨re image buildÃ©e.
    

---

## âœ… RÃ©sumÃ©

- Ionos possÃ¨de un **firewall externe** â†’ il faut ouvrir **80/443** (et pas 8080).
    
- Le VPS peut avoir un firewall interne (**UFW**) â†’ vÃ©rifier et autoriser les ports.
    
- Le mapping `-p 80:8080` permet dâ€™exposer ton app sur `http://<ip>` sans devoir utiliser `:8080` dans lâ€™URL.
    
- Les commandes Docker Ã  connaÃ®tre : `run`, `ps`, `stop`, `rm`.
    
- Le cycle complet de dÃ©ploiement sur VPS = **pull image â†’ stop ancien conteneur â†’ run nouveau conteneur**.
    
